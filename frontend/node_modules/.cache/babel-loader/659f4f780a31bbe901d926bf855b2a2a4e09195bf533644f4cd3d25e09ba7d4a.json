{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Franz H. Dulnuan/Documents/softEng-Act/Hotel-final/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Franz H. Dulnuan/Documents/softEng-Act/Hotel-final/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Franz H. Dulnuan/Documents/softEng-Act/Hotel-final/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import{useParams}from\"react-router-dom\";import axios from\"axios\";import Loader from\"../components/Loader\";import Error from\"../components/Error\";import moment from\"moment\";import StripeCheckout from\"react-stripe-checkout\";import swal from\"sweetalert2\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Bookingscreen=function Bookingscreen(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setloading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],seterror=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),room=_useState6[0],setroom=_useState6[1];var _useParams=useParams(),id=_useParams.id,fromdate=_useParams.fromdate,todate=_useParams.todate;var fromd=moment(fromdate,\"DD-MM-YYYY\");var tod=moment(todate,\"DD-MM-YYYY\");var totaldays=moment.duration(tod.diff(fromd)).asDays()+1;var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),totalamount=_useState8[0],settotalamount=_useState8[1];useEffect(function(){if(!localStorage.getItem('currentuser')){window.location.reload='/login';}var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;setloading(true);_context.next=4;return axios.post(\"http://localhost:5000/api/rooms/getroombyid\",{roomid:id});case 4:data=_context.sent.data;settotalamount(data.rentperday*totaldays);setroom(data);setloading(false);console.log(data);_context.next=16;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);seterror(true);console.log(_context.t0);setloading(false);case 16:case\"end\":return _context.stop();}},_callee,null,[[0,11]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[]);function onToken(_x){return _onToken.apply(this,arguments);}function _onToken(){_onToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(token){var bookingdetails,result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:bookingdetails={room:room,userid:JSON.parse(localStorage.getItem(\"currentuser\"))._id,fromdate:fromd,todate:tod,totalamount:totalamount,totaldays:totaldays,token:token};_context2.prev=1;setloading(true);_context2.next=5;return axios.post(\"http://localhost:5000/api/bookings/bookroom\",bookingdetails);case 5:result=_context2.sent;setloading(false);swal.fire(\"Congratulations\",\"Room booked Successfully\",\"success\").then(function(result){window.location.href='/profile';});_context2.next=14;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);setloading(false);swal.fire(\"Oops\",\"Something went wrong\",\"error\").then(function(result){window.location.href='/profile';});case 14:case\"end\":return _context2.stop();}},_callee2,null,[[1,10]]);}));return _onToken.apply(this,arguments);}return/*#__PURE__*/_jsx(\"div\",{className:\"m-5\",children:loading?/*#__PURE__*/_jsx(Loader,{}):room?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row justify-content-center mt-5 bs\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5\",children:[/*#__PURE__*/_jsx(\"h1\",{children:room.name}),/*#__PURE__*/_jsx(\"img\",{src:room.imageurls[0],className:\"bigimg\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"right\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Booking Details\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Name:\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"From Date: \",fromdate]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"To Date: \",todate]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Max Count: \",room.maxcount]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"right\"},children:/*#__PURE__*/_jsxs(\"b\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Amount\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total days : \",totaldays]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Rent per day : \",room.rentperday]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Total Amount : \",totalamount]})]})}),/*#__PURE__*/_jsx(\"div\",{style:{float:\"right\"},children:/*#__PURE__*/_jsx(StripeCheckout,{amount:totalamount*100,token:onToken,currency:\"php\",stripeKey:\"pk_test_51MzzS9JdQqwRgXNg9MOSaTWDnIuX3KpCDxjd2l0oeXOHRktdKt9GRbWWeAItViLroJ7jzEGfga4tTURy3SQ9gwQF00ZRBZrxa0\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",children:\"Pay Now\"})})})]})]})}):/*#__PURE__*/_jsx(Error,{})});};export default Bookingscreen;","map":{"version":3,"names":["React","useState","useEffect","useParams","axios","Loader","Error","moment","StripeCheckout","swal","jsx","_jsx","jsxs","_jsxs","Bookingscreen","_useState","_useState2","_slicedToArray","loading","setloading","_useState3","_useState4","error","seterror","_useState5","_useState6","room","setroom","_useParams","id","fromdate","todate","fromd","tod","totaldays","duration","diff","asDays","_useState7","_useState8","totalamount","settotalamount","localStorage","getItem","window","location","reload","fetchData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","data","wrap","_callee$","_context","prev","next","post","roomid","sent","rentperday","console","log","t0","stop","apply","arguments","onToken","_x","_onToken","_callee2","token","bookingdetails","result","_callee2$","_context2","userid","JSON","parse","_id","fire","then","href","className","children","name","src","imageurls","style","textAlign","maxcount","float","amount","currency","stripeKey"],"sources":["C:/Users/Franz H. Dulnuan/Documents/softEng-Act/Hotel-final/frontend/src/screens/Bookingscreen.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport Loader from \"../components/Loader\";\r\nimport Error from \"../components/Error\";\r\nimport moment from \"moment\";\r\nimport StripeCheckout from \"react-stripe-checkout\";\r\nimport swal from \"sweetalert2\";\r\n\r\nconst Bookingscreen = () => {\r\n  const [loading, setloading] = useState(true);\r\n  const [error, seterror] = useState();\r\n  const [room, setroom] = useState();\r\n\r\n  const { id, fromdate, todate } = useParams();\r\n\r\n  const fromd = moment(fromdate, \"DD-MM-YYYY\");\r\n  const tod = moment(todate, \"DD-MM-YYYY\");\r\n\r\n  const totaldays = moment.duration(tod.diff(fromd)).asDays() + 1;\r\n  const [totalamount, settotalamount] = useState();\r\n\r\n  useEffect(() => {\r\n    if(!localStorage.getItem('currentuser')){\r\n      window.location.reload = '/login'\r\n    }\r\n    const fetchData = async () => {\r\n      try {\r\n        setloading(true);\r\n        const data = (\r\n          await axios.post(\"http://localhost:5000/api/rooms/getroombyid\", { roomid: id })\r\n        ).data;\r\n        settotalamount(data.rentperday * totaldays);\r\n        setroom(data);\r\n        setloading(false);\r\n        console.log(data);\r\n      } catch (error) {\r\n        seterror(true);\r\n        console.log(error);\r\n        setloading(false);\r\n      }\r\n    };\r\n    fetchData();\r\n  }, []);\r\n\r\n  async function onToken(token) {\r\n    const bookingdetails = {\r\n      room,\r\n      userid: JSON.parse(localStorage.getItem(\"currentuser\"))._id,\r\n      fromdate: fromd,\r\n      todate: tod,\r\n      totalamount,\r\n      totaldays,\r\n      token,\r\n    };\r\n\r\n    try {\r\n      setloading(true);\r\n      const result = await axios.post(\"http://localhost:5000/api/bookings/bookroom\", bookingdetails);\r\n      setloading(false);\r\n      swal.fire(\"Congratulations\", \"Room booked Successfully\", \"success\").then(result => {window.location.href = '/profile'});\r\n    } catch (error) {\r\n      setloading(false);\r\n      swal.fire(\"Oops\", \"Something went wrong\", \"error\").then(result => {window.location.href = '/profile'});\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"m-5\">\r\n      {loading ? (\r\n        <Loader />\r\n      ) : room ? (\r\n        <div>\r\n          <div className=\"row justify-content-center mt-5 bs\">\r\n            <div className=\"col-md-5\">\r\n              <h1>{room.name}</h1>\r\n              <img src={room.imageurls[0]} className=\"bigimg\" />\r\n            </div>\r\n            <div className=\"col-md-5\">\r\n              <div style={{ textAlign: \"right\" }}>\r\n                <h1>Booking Details</h1>\r\n                <hr />\r\n                <b>\r\n                  <p>Name:</p>\r\n                  <p>From Date: {fromdate}</p>\r\n                  <p>To Date: {todate}</p>\r\n                  <p>Max Count: {room.maxcount}</p>\r\n                </b>\r\n              </div>\r\n              <div style={{ textAlign: \"right\" }}>\r\n                <b>\r\n                  <h1>Amount</h1>\r\n                  <hr />\r\n                  <p>Total days : {totaldays}</p>\r\n                  <p>Rent per day : {room.rentperday}</p>\r\n                  <p>Total Amount : {totalamount}</p>\r\n                </b>\r\n              </div>\r\n              <div style={{ float: \"right\" }}>\r\n                <StripeCheckout\r\n                  amount={totalamount * 100}\r\n                  token={onToken}\r\n                  currency=\"php\"\r\n                  stripeKey=\"pk_test_51MzzS9JdQqwRgXNg9MOSaTWDnIuX3KpCDxjd2l0oeXOHRktdKt9GRbWWeAItViLroJ7jzEGfga4tTURy3SQ9gwQF00ZRBZrxa0\"\r\n                >\r\n                  <button className=\"btn btn-primary\">Pay Now</button>\r\n                </StripeCheckout>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <Error />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Bookingscreen;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}